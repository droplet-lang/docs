"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[125],{3078:(n,e,i)=>{i.r(e),i.d(e,{assets:()=>l,contentTitle:()=>a,default:()=>u,frontMatter:()=>r,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"tools_and_eco/native_lib","title":"Writing Native Libraries","description":"Droplet allows extending the language by writing native functions in C/C++.","source":"@site/docs/tools_and_eco/native_lib.md","sourceDirName":"tools_and_eco","slug":"/tools_and_eco/native_lib","permalink":"/docs/docs/tools_and_eco/native_lib","draft":false,"unlisted":false,"editUrl":"https://github.com/droplet-lang/lang/edit/main/website/docs/tools_and_eco/native_lib.md","tags":[],"version":"current","sidebarPosition":6,"frontMatter":{"sidebar_position":6},"sidebar":"tutorialSidebar","previous":{"title":"Virtual Machine Overview","permalink":"/docs/docs/tools_and_eco/vm_overview"},"next":{"title":"VSCode Extension","permalink":"/docs/docs/tools_and_eco/vscode"}}');var s=i(4848),o=i(8453);const r={sidebar_position:6},a="Writing Native Libraries",l={},c=[{value:"\ud83d\udd39 Creating a Native Function",id:"-creating-a-native-function",level:2},{value:"\u270f\ufe0f Example: Custom Native Functions",id:"\ufe0f-example-custom-native-functions",level:2},{value:"\ud83d\udd04 Using Native Functions in Droplet",id:"-using-native-functions-in-droplet",level:2},{value:"\ud83e\udde0 Notes",id:"-notes",level:2}];function d(n){const e={br:"br",code:"code",h1:"h1",h2:"h2",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...n.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e.header,{children:(0,s.jsx)(e.h1,{id:"writing-native-libraries",children:"Writing Native Libraries"})}),"\n",(0,s.jsxs)(e.p,{children:["Droplet allows extending the language by writing ",(0,s.jsx)(e.strong,{children:"native functions"})," in C/C++.",(0,s.jsx)(e.br,{}),"\n","These functions can be registered in the VM and called from Droplet code."]}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h2,{id:"-creating-a-native-function",children:"\ud83d\udd39 Creating a Native Function"}),"\n",(0,s.jsx)(e.p,{children:"Native functions have this signature:"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"void native_function_name(VM& vm, const uint8_t argc);\n"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"vm"})," \u2192 Reference to the Droplet VM instance"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"argc"})," \u2192 Number of arguments passed from Droplet"]}),"\n"]}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h2,{id:"\ufe0f-example-custom-native-functions",children:"\u270f\ufe0f Example: Custom Native Functions"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:'#include "VM.h"\n#include <iostream>\n\nvoid native_print(VM& vm, const uint8_t argc) {\n    for (int i = 0; i < argc; i++) {\n        std::cout << vm.popValue() << " ";\n    }\n    std::cout << std::endl;\n}\n\nvoid native_len(VM& vm, const uint8_t argc) {\n    auto val = vm.popValue();\n    vm.pushValue(val.size());  // Push length back to stack\n}\n\n// Register functions in VM\ninline void register_native_functions(VM& vm) {\n    vm.register_native("print", native_print);\n    vm.register_native("len", native_len);\n}\n'})}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h2,{id:"-using-native-functions-in-droplet",children:"\ud83d\udd04 Using Native Functions in Droplet"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-rust",children:'fn main() {\n    print("Hello from native function!")\n    println("Length of list:", len([1,2,3,4]))\n}\n'})}),"\n",(0,s.jsx)(e.p,{children:"Output:"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"Hello from native function!\nLength of list: 4\n"})}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h2,{id:"-notes",children:"\ud83e\udde0 Notes"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["Native functions are ",(0,s.jsx)(e.strong,{children:"directly executed by the VM"}),"."]}),"\n",(0,s.jsxs)(e.li,{children:["They provide ",(0,s.jsx)(e.strong,{children:"access to system libraries"})," or optimized operations."]}),"\n",(0,s.jsxs)(e.li,{children:["Arguments are managed on the VM ",(0,s.jsx)(e.strong,{children:"stack"}),", and return values must be pushed back."]}),"\n",(0,s.jsxs)(e.li,{children:["This mechanism allows ",(0,s.jsx)(e.strong,{children:"learning how languages interface with low-level code"}),"."]}),"\n"]})]})}function u(n={}){const{wrapper:e}={...(0,o.R)(),...n.components};return e?(0,s.jsx)(e,{...n,children:(0,s.jsx)(d,{...n})}):d(n)}},8453:(n,e,i)=>{i.d(e,{R:()=>r,x:()=>a});var t=i(6540);const s={},o=t.createContext(s);function r(n){const e=t.useContext(o);return t.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function a(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(s):n.components||s:r(n.components),t.createElement(o.Provider,{value:e},n.children)}}}]);