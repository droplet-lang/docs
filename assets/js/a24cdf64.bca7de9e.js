"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[289],{8453:(e,n,i)=>{i.d(n,{R:()=>t,x:()=>o});var s=i(6540);const r={},l=s.createContext(r);function t(e){const n=s.useContext(l);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),s.createElement(l.Provider,{value:n},e.children)}},9172:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>t,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"tools_and_eco/vm_overview","title":"Virtual Machine Overview","description":"The Droplet Virtual Machine (VM) executes bytecode generated by the Droplet compiler.","source":"@site/docs/tools_and_eco/vm_overview.md","sourceDirName":"tools_and_eco","slug":"/tools_and_eco/vm_overview","permalink":"/docs/docs/tools_and_eco/vm_overview","draft":false,"unlisted":false,"editUrl":"https://github.com/droplet-lang/lang/edit/main/website/docs/tools_and_eco/vm_overview.md","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"sidebar_position":5},"sidebar":"tutorialSidebar","previous":{"title":"Memory Model","permalink":"/docs/docs/tools_and_eco/mem_model"},"next":{"title":"Writing Native Libraries","permalink":"/docs/docs/tools_and_eco/native_lib"}}');var r=i(4848),l=i(8453);const t={sidebar_position:5},o="Virtual Machine Overview",c={},d=[{value:"\ud83d\udd39 Components of the VM",id:"-components-of-the-vm",level:2},{value:"\ud83d\udd04 Execution Flow",id:"-execution-flow",level:2},{value:"\u270f\ufe0f Example Flow",id:"\ufe0f-example-flow",level:2},{value:"\ud83e\udde0 Notes",id:"-notes",level:2}];function a(e){const n={br:"br",code:"code",h1:"h1",h2:"h2",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"virtual-machine-overview",children:"Virtual Machine Overview"})}),"\n",(0,r.jsxs)(n.p,{children:["The Droplet Virtual Machine (VM) executes ",(0,r.jsx)(n.strong,{children:"bytecode"})," generated by the Droplet compiler.",(0,r.jsx)(n.br,{}),"\n","It is designed as a ",(0,r.jsx)(n.strong,{children:"stack-based VM"})," to demonstrate how programming languages execute code."]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"-components-of-the-vm",children:"\ud83d\udd39 Components of the VM"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Instruction Stack"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Stores temporary values and operands."}),"\n",(0,r.jsx)(n.li,{children:"Used for arithmetic, function calls, and expression evaluation."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Call Frames"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Each function call creates a ",(0,r.jsx)(n.strong,{children:"frame"})," on the stack."]}),"\n",(0,r.jsx)(n.li,{children:"Stores local variables, instruction pointer, and return address."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Heap"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Stores dynamically allocated objects, strings, lists, and maps."}),"\n",(0,r.jsxs)(n.li,{children:["Managed by a simple ",(0,r.jsx)(n.strong,{children:"garbage collector"}),"."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Native Function Registry"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Built-in functions like ",(0,r.jsx)(n.code,{children:"print"}),", ",(0,r.jsx)(n.code,{children:"println"}),", ",(0,r.jsx)(n.code,{children:"len"}),", ",(0,r.jsx)(n.code,{children:"str"})," are registered here."]}),"\n",(0,r.jsx)(n.li,{children:"VM calls these directly without bytecode instructions."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"-execution-flow",children:"\ud83d\udd04 Execution Flow"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Load ",(0,r.jsx)(n.code,{children:".dbc"})," bytecode file."]}),"\n",(0,r.jsxs)(n.li,{children:["Set instruction pointer to ",(0,r.jsx)(n.code,{children:"main"})," function."]}),"\n",(0,r.jsxs)(n.li,{children:["Execute instructions sequentially:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Push/pop values on stack"}),"\n",(0,r.jsx)(n.li,{children:"Call functions (user-defined or native)"}),"\n",(0,r.jsx)(n.li,{children:"Perform arithmetic and comparisons"}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.li,{children:"Allocate objects on the heap as needed."}),"\n",(0,r.jsx)(n.li,{children:"Clean up stack frames when functions return."}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"\ufe0f-example-flow",children:"\u270f\ufe0f Example Flow"}),"\n",(0,r.jsx)(n.p,{children:"Given this program:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-rust",children:'fn main() {\n    println("Hello VM!")\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:"VM execution steps:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"main"})," function frame is created on stack."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:'println("Hello VM!")'})," instruction pushes string onto stack."]}),"\n",(0,r.jsxs)(n.li,{children:["Native function ",(0,r.jsx)(n.code,{children:"println"})," is called."]}),"\n",(0,r.jsxs)(n.li,{children:["Stack frame for ",(0,r.jsx)(n.code,{children:"main"})," is removed after completion."]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Output:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Hello VM!\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"-notes",children:"\ud83e\udde0 Notes"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["The VM uses a ",(0,r.jsx)(n.strong,{children:"stack-based architecture"})," for simplicity."]}),"\n",(0,r.jsx)(n.li,{children:"Objects and dynamically-sized structures live on the heap."}),"\n",(0,r.jsx)(n.li,{children:"Native functions provide interaction with the host environment."}),"\n",(0,r.jsxs)(n.li,{children:["This VM is ",(0,r.jsx)(n.strong,{children:"educational"}),", showing how programming languages execute code internally."]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}}}]);