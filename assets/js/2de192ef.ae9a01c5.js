"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[287],{6614:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>u,frontMatter:()=>a,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"language_basics/error","title":"Error Handling","description":"Droplet provides a safe and explicit error handling mechanism inspired by Rust\'s Result type and Swift\'s error handling. Instead of exceptions, Droplet uses error types (marked with !) that force you to handle errors before using values.","source":"@site/docs/language_basics/error.md","sourceDirName":"language_basics","slug":"/language_basics/error","permalink":"/docs/docs/language_basics/error","draft":false,"unlisted":false,"editUrl":"https://github.com/droplet-lang/lang/edit/main/website/docs/language_basics/error.md","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"sidebar_position":5},"sidebar":"tutorialSidebar","previous":{"title":"Functions","permalink":"/docs/docs/language_basics/functions"},"next":{"title":"Data Structure","permalink":"/docs/docs/category/data-structure"}}');var t=r(4848),i=r(8453);const a={sidebar_position:5},o="Error Handling",l={},c=[{value:"The Error Class",id:"the-error-class",level:2},{value:"Error Types (<code>T!</code>)",id:"error-types-t",level:2},{value:"Checking for Errors",id:"checking-for-errors",level:2},{value:"Pattern 1: If-Else",id:"pattern-1-if-else",level:3},{value:"Pattern 2: Early Return (Guard Pattern)",id:"pattern-2-early-return-guard-pattern",level:3},{value:"Pattern 3: Propagating Errors",id:"pattern-3-propagating-errors",level:3},{value:"Methods Returning Errors",id:"methods-returning-errors",level:2},{value:"Type Safety",id:"type-safety",level:2},{value:"Custom Error Types",id:"custom-error-types",level:2}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",strong:"strong",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"error-handling",children:"Error Handling"})}),"\n",(0,t.jsxs)(n.p,{children:["Droplet provides a safe and explicit error handling mechanism inspired by Rust's ",(0,t.jsx)(n.code,{children:"Result"})," type and Swift's error handling. Instead of exceptions, Droplet uses ",(0,t.jsx)(n.strong,{children:"error types"})," (marked with ",(0,t.jsx)(n.code,{children:"!"}),") that force you to handle errors before using values."]}),"\n",(0,t.jsx)(n.h2,{id:"the-error-class",children:"The Error Class"}),"\n",(0,t.jsxs)(n.p,{children:["Droplet provides a built-in ",(0,t.jsx)(n.code,{children:"Error"})," class that serves as the base for all errors:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-droplet",children:"class Error {\n    message: str\n\n    new(message: str) {\n        self.message = message\n    }\n}\n"})}),"\n",(0,t.jsxs)(n.p,{children:["You can extend ",(0,t.jsx)(n.code,{children:"Error"})," to create custom error types:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-droplet",children:"class FileNotFoundError extends Error {\n    path: str\n\n    new(path: str, message: str) {\n        self.message = message\n        self.path = path\n    }\n}\n\nclass NetworkError extends Error {\n    code: int\n\n    new(code: int, message: str) {\n        self.message = message\n        self.code = code\n    }\n}\n"})}),"\n",(0,t.jsxs)(n.h2,{id:"error-types-t",children:["Error Types (",(0,t.jsx)(n.code,{children:"T!"}),")"]}),"\n",(0,t.jsxs)(n.p,{children:["When a function may return either a value or an error, mark its return type with ",(0,t.jsx)(n.code,{children:"!"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-droplet",children:'fn divide(a: int, b: int) -> float! {\n    if b == 0 {\n        return Error("Division by zero")\n    }\n    return float(a) / float(b)\n}\n'})}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"float!"}),' type means "this function returns either a ',(0,t.jsx)(n.code,{children:"float"})," or an ",(0,t.jsx)(n.code,{children:"Error"}),'".']}),"\n",(0,t.jsx)(n.h2,{id:"checking-for-errors",children:"Checking for Errors"}),"\n",(0,t.jsxs)(n.p,{children:["Before using a value from a function that returns ",(0,t.jsx)(n.code,{children:"T!"}),", you ",(0,t.jsx)(n.strong,{children:"must"})," check if it's an error using the ",(0,t.jsx)(n.code,{children:"is Error"})," operator:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-droplet",children:'fn main() {\n    let result = divide(10, 0)\n    \n    // \u274c This won\'t compile - must check for error first!\n    // println(result)\n    \n    if result is Error {\n        println("Error: " + result.message)\n    } else {\n        println("Result: " + str(result))\n    }\n}\n'})}),"\n",(0,t.jsx)(n.h3,{id:"pattern-1-if-else",children:"Pattern 1: If-Else"}),"\n",(0,t.jsx)(n.p,{children:"The most common pattern is to use if-else to handle both cases:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-droplet",children:'let result = someFunction()\n\nif result is Error {\n    // In this block, result is type Error\n    println("Something went wrong: " + result.message)\n    // Handle the error\n} else {\n    // In this block, result is unwrapped (type T)\n    println("Success: " + str(result))\n}\n'})}),"\n",(0,t.jsx)(n.h3,{id:"pattern-2-early-return-guard-pattern",children:"Pattern 2: Early Return (Guard Pattern)"}),"\n",(0,t.jsx)(n.p,{children:"If the error branch definitely returns or exits, the variable is automatically unwrapped after the if statement:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-droplet",children:"fn processFile(filename: str) -> str {\n    let contents = readFile(filename)  // Returns str!\n    \n    if contents is Error {\n        println(\"Failed to read file: \" + contents.message)\n        exit(1)\n    }\n    \n    // After the if block, 'contents' is automatically unwrapped to str\n    return contents.toUpperCase()\n}\n"})}),"\n",(0,t.jsxs)(n.p,{children:["This works because the compiler knows that if ",(0,t.jsx)(n.code,{children:"contents"})," is an error, the program will exit, so beyond that point it ",(0,t.jsx)(n.strong,{children:"must"})," be a valid string."]}),"\n",(0,t.jsx)(n.h3,{id:"pattern-3-propagating-errors",children:"Pattern 3: Propagating Errors"}),"\n",(0,t.jsx)(n.p,{children:"You can return errors from your own functions:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-droplet",children:'fn readAndParse(filename: str) -> int! {\n    let contents = readFile(filename)  // Returns str!\n    \n    if contents is Error {\n        // Propagate the error up\n        return contents\n    }\n    \n    let number = parseInt(contents)  // Returns int!\n    \n    if number is Error {\n        return Error("Invalid number in file")\n    }\n    \n    return number\n}\n'})}),"\n",(0,t.jsx)(n.h2,{id:"methods-returning-errors",children:"Methods Returning Errors"}),"\n",(0,t.jsx)(n.p,{children:"Class methods can also return error types:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-droplet",children:'class Database {\n    connected: bool\n\n    new() {\n        self.connected = false\n    }\n\n    fn connect(url: str) -> bool! {\n        if !isValidUrl(url) {\n            return Error("Invalid database URL")\n        }\n        \n        // Try to connect...\n        if !connectionSuccessful {\n            return Error("Connection failed")\n        }\n        \n        self.connected = true\n        return true\n    }\n    \n    fn query(sql: str) -> list[str]! {\n        if !self.connected {\n            return Error("Not connected to database")\n        }\n        \n        // Execute query...\n        return results\n    }\n}\n\nfn main() {\n    let db = Database()\n    let connected = db.connect("localhost:5432")\n    \n    if connected is Error {\n        println("Failed to connect: " + connected.message)\n        exit(1)\n    }\n    \n    let results = db.query("SELECT * FROM users")\n    \n    if results is Error {\n        println("Query failed: " + results.message)\n        exit(1)\n    }\n    \n    // Use results safely\n    for row in results {\n        println(row)\n    }\n}\n'})}),"\n",(0,t.jsx)(n.h2,{id:"type-safety",children:"Type Safety"}),"\n",(0,t.jsx)(n.p,{children:"The compiler enforces error checking at compile-time:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-droplet",children:'fn riskyOperation() -> int! {\n    // ...\n}\n\nfn main() {\n    let value = riskyOperation()\n    \n    // \u274c Compile error: Cannot use a possibly failing value of type int! \n    //    without handling the Error first\n    let doubled = value * 2\n    \n    // \u2705 Correct: Check for error first\n    if value is Error {\n        println("Operation failed")\n        exit(1)\n    }\n    \n    let doubled = value * 2  // Now safe to use\n}\n'})}),"\n",(0,t.jsx)(n.h2,{id:"custom-error-types",children:"Custom Error Types"}),"\n",(0,t.jsxs)(n.p,{children:["Create domain-specific errors by extending the ",(0,t.jsx)(n.code,{children:"Error"})," class:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-droplet",children:'class ValidationError extends Error {\n    field: str\n\n    new(field: str, message: str) {\n        self.message = message\n        self.field = field\n    }\n}\n\nfn validateEmail(email: str) -> str! {\n    if !email.contains("@") {\n        return ValidationError("email", "Email must contain @")\n    }\n    \n    if email.length < 5 {\n        return ValidationError("email", "Email too short")\n    }\n    \n    return email\n}\n\nfn main() {\n    let email = validateEmail("bad")\n    \n    if email is Error {\n        if email is ValidationError {\n            println("Invalid " + email.field + ": " + email.message)\n        } else {\n            println("Error: " + email.message)\n        }\n        exit(1)\n    }\n    \n    println("Valid email: " + email)\n}\n'})})]})}function u(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>a,x:()=>o});var s=r(6540);const t={},i=s.createContext(t);function a(e){const n=s.useContext(i);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),s.createElement(i.Provider,{value:n},e.children)}}}]);